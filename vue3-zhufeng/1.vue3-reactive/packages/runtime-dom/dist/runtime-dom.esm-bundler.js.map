{"version":3,"file":"runtime-dom.esm-bundler.js","sources":["../../shared/src/index.ts","../src/nodeOps.ts","../src/modules/attr.ts","../src/modules/class.ts","../src/modules/events.ts","../src/modules/style.ts","../src/patchProp.ts","../../runtime-core/src/vnode.ts","../../runtime-core/src/apiCreateApp.ts","../../runtime-core/src/renderer.ts","../src/index.ts"],"sourcesContent":["export const isObject = (value) => typeof value == 'object' && value !== null;\nexport const extend = Object.assign\nexport const isArray = Array.isArray;\nexport const isFunction = (value) => typeof value == 'function'\nexport const isNumber = (value) => typeof value == 'number';\nexport const isString = (value) => typeof value === 'string';\nexport const isIntegerKey = (key) => parseInt(key) + '' === key;\n\n\nlet hasOwnpRroperty = Object.prototype.hasOwnProperty;\nexport const hasOwn = (target, key) => hasOwnpRroperty.call(target, key);\n\nexport const hasChanged = (oldValue,value) => oldValue !== value\n\nexport * from './shapeFlag'","export const nodeOps = {\n  createElement: tagName => document.createElement(tagName),\n  remove: child => {// 删除\n      const parent = child.parentNode;\n      if(parent){\n        parent.removeChild(child)\n      }\n  },\n  insert: (child, parent, anchor = null) => {\n    parent.insertBefore(child, anchor); // \n  },\n  querySelector: selector => document.querySelector(selector),\n  setElementText: (el, text) => el.textContent = text,\n  createText: text => document.createTextNode(text),\n  setText: (node, text) => node.nodeValue = text\n}","\n\nexport const patchAttr = (el,key,value) =>{\n  if(value == null){\n      el.removeAttribute(key);\n  }else {\n      el.setAttribute(key,value);\n  }\n}","export const patchClass = (el ,value) => {\n  if(value == null){\n    value = ''\n  }\n  el.className = value\n}\n","export const patchEvent = (el, key, value) => {\n  // 对函数的缓存\n  const invokers = el._vei || (el._vei || {})\n  const exists = invokers[key]; // 如果不存在\n  if(value && exists){ // 更新绑定事件\n    exists.value = value;\n  }else{\n    const eventName = key.slice(2).toLowerCase()\n    if(value){ // 之前没有绑定过现在绑定\n      let invoker = invokers[key] = createInvoker(value);\n       el.addEventListener(eventName,invoker)\n    }else{\n      if(exists){ // 以前绑定了 当时没有value\n        el.removeEventListener(eventName,exists);\n        // invokers[key] = undefined;\n        delete invokers[key]\n      }\n    }\n  }\n}\n\nfunction createInvoker(value) {\n  const invoker = (e) => { invoker.value(e)} \n  invoker.value = value;\n  return invoker\n}","export const patchStyle = (el,prev,next) =>{ // cssText;\n  const style = el.style; //获取样式 \n  if(next == null){\n      el.removeAttribute('style') // {style:{}}  {}\n  }else{\n      // 老的里新的有没有 \n      if(prev){  // {style:{color}} => {style:{background}}\n          for(let key in prev){\n              if(next[key] == null){ // 老的里有 新的里没有 需要删除\n                  style[key] = '';\n              }\n          }\n      }\n      // 新的里面需要赋值到style上\n      for(let key in next){ // {style:{color}} => {style:{background}}\n          style[key] = next[key];\n      }\n  }\n\n}","import { patchAttr } from \"./modules/attr\";\nimport { patchClass } from \"./modules/class\";\nimport { patchEvent } from \"./modules/events\";\nimport { patchStyle } from \"./modules/style\";\n\n// 这个里面针对的是属性操作\nexport const patchProp = (el, key, preValue, nextValue) => {\n  switch (key) {\n    case \"class\":\n      patchClass(el, nextValue); // 比对属性\n      break;\n    case \"style\": // {style:{color:'red'}}  {style:{background:'red'}}\n      patchStyle(el, preValue, nextValue);\n      break;\n    default:\n      // 如果不是事件 才是属性\n      if (/^on[^a-z]/.test(key)) {\n        patchEvent(el, key, nextValue); // 事件就是添加和删除 修改\n      } else {\n        patchAttr(el, key, nextValue);\n      }\n\n      break;\n  }\n};\n","import { isArray, isObject, isString, ShapeFlags } from \"@vue/shared\"\n\n// h(‘div',{style:{color:red}},'children'); //  h方法和createApp类似\nexport const createVNode = (type, props, children = null) => {\n  // 可以 根据 type 来区分是组件还是 普通组件\n\n  // 根据type来区分 是元素还是组件\n\n  // 虚拟DOM 肯定有一个蕾西\n  const shapeFlag = isString(type) ? ShapeFlags.ELEMENT : isObject(type) ? ShapeFlags.STATEFUL_COMPONENT : 0\n  const vnode = { // 一个对象\n    __v_isVnode: true,\n    type,\n    props,\n    children,\n    component: null, //存放组件实例\n    el: null, // 真实dom\n    key: props && props.key, // diff 算法\n    shapeFlag // 判断自己的类型 和 儿子的类型 ； 主要是为了看儿子的类型是啥，做分别的处理， 父的类型是和子 不相同的\n  }\n  normalizeChildren(vnode, children);\n  return  vnode;\n}\n\nfunction normalizeChildren(vnode,children){\n  console.log('normalizeChildren', children)\n  let type = 0;\n  if(children == null){ // 不对儿子进行处理\n\n  } else if(isArray(children)){\n      type = ShapeFlags.ARRAY_CHILDREN;\n  } else{\n      type = ShapeFlags.TEXT_CHILDREN;\n  }\n  vnode.shapeFlag |=  type\n}\n\nexport const Text = Symbol('Text')","// import { createVNode } from \"./vnode\"\n\nimport { createVNode } from \"./vnode\"\n\nexport function createAppAPI(render){\n    return function createApp(rootComponent,rootProps){ // 告诉他那个组件那个属性来创建的应用\n      console.log('>>>>>>')\n        const app = {\n            _props:rootProps,\n            _component:rootComponent,\n            _container:null,\n            mount(container){ // 挂载的目的地\n                // let vnode = {}\n                // render(vnode,container);\n\n                // 1.根据组件创建虚拟节点\n                // 2.将虚拟节点和容器获取到后调用render方法进行渲染\n\n                // 创造虚拟节点\n                const vnode = createVNode(rootComponent,rootProps)\n\n                // // 调用render\n                render(vnode,container)\n\n\n                app._container = container\n            }\n        }\n        return app\n    }\n}","import { ShapeFlags } from \"@vue/shared\";\nimport { createAppAPI } from \"./apiCreateApp\";\nimport { Text } from \"./vnode\";\n\nexport function createRenderer(rendererOptions) {\n\n  const {\n    insert: hostInsert,\n    remove: hostRemove,\n    patchProp: hostPatchProp,\n    createElement: hostCreateElement,\n    createText: hostCreateText,\n    createComment: hostCreateComment,\n    setText: hostSetText,\n    setElementText: hostSetElementText,\n} = rendererOptions\n\n  const mountComponent = (initialVNode, container) => {\n    // 组件的渲染流程  最核心的就是调用 setup拿到返回值，获取render函数返回的结果来进行渲染 \n    // 1.先有实例\n    // const instance = (initialVNode.component = createComponentInstance(initialVNode))\n    // 2.需要的数据解析到实例上\n    // setupComponent(instance); // state props attrs render ....\n    // 3.创建一个effect 让render函数执行\n    // setupRenderEfect(instance, container);\n}\n\n  const processComponent = (n1, n2, container) => {\n    if (n1 == null) { // 组件没有上一次的虚拟节点\n        mountComponent(n2, container);\n    } else {\n        // 组件更新流程 \n    }\n}\n// 处理元素\nconst mountElement = (vnode, container) => {\n  // 递归渲染\n  const { props, shapeFlag, type, children } = vnode;\n  let el = (vnode.el = hostCreateElement(type));\n\n  if (props) {\n      for (const key in props) {\n          hostPatchProp(el, key, null, props[key]);\n      }\n  }\n  console.log('ShapeFlags.TEXT_CHILDREN', ShapeFlags.TEXT_CHILDREN)\n  console.log('shapeFlag', shapeFlag)\n  console.log(shapeFlag & ShapeFlags.TEXT_CHILDREN);\n  // if (shapeFlag & ShapeFlags.TEXT_CHILDREN) {\n  //     hostSetElementText(el, children);// 文本比较简单 直接扔进去即可\n  // } else if (shapeFlag & ShapeFlags.ARRAY_CHILDREN) {\n  //     mountChildren(children, el);\n  // }\n  hostInsert(el, container);\n}\nconst processElement = (n1, n2, container) => {\n  if (n1 == null) {\n      mountElement(n2, container);\n  } else {\n      // 元素更新\n  }\n}\n\n  const patch = (n1, n2, container) => {\n    const { shapeFlag, type } = n2;\n    console.log('n2', n2);\n    switch (type) {\n      case Text:\n        // 操作text\n        break;\n      default:\n        if (shapeFlag & ShapeFlags.ELEMENT) {\n          processElement(n1, n2, container);\n        } else if (shapeFlag & ShapeFlags.STATEFUL_COMPONENT) {\n          // processComponent(n1, n2, container);\n        }\n    }\n  };\n\n  // 告诉core 怎么渲染\n  const render = (vnode, container) => {\n    // core的核心, 根据不同的虚拟节点 创建对应的真实元素\n    // 默认调用render 可能是初始化流程\n    patch(null, vnode, container)\n  };\n  return {\n    createApp: createAppAPI(render),\n  };\n}\n","// runtime-dom 核心就是  提供domAPI方法了\n//操作节点、操作属性的更新\n// 节点操作就是增删改查 \n// 属性操作 添加 删除 更新 (样式、类、事件、其他属性)\nimport { extend } from \"@vue/shared/src\";\nimport { nodeOps } from \"./nodeOps\"; // 对象\nimport { patchProp } from \"./patchProp\"; // 方法\nimport { createRenderer } from '@vue/runtime-core/src'\n\n\n// 渲染时用到的所有方法\nconst rendererOptions = extend({ patchProp }, nodeOps)\n\n// vue中runtime-core 提供了核心的方法 用来处理渲染的，他会使用runtime-dom中的api进行渲染\nexport function createApp(rootComponent, rootProps = null) {\n  const app: any = createRenderer(rendererOptions).createApp(rootComponent,rootProps)\n  let {mount} = app\n  app.mount = function (container) {\n      // // 清空容器的操作 \n      container = nodeOps.querySelector(container);\n      container.innerHTML = '';\n      mount(container); // 函数劫持\n      \n  }\n  return app;\n}\n\nexport * from '@vue/runtime-core';\nexport default {}"],"names":[],"mappings":"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"}